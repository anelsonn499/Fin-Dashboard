function doGet(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Sheet1");
  const data = sheet.getDataRange().getValues();
  const result = data.slice(1).map(row => ({
    name: row[0],
    balance: row[1],
    dueDate: row[2],
    website: row[3],
    history: typeof row[4] === 'string'
      ? row[4].split(',').map(Number)
      : typeof row[4] === 'number'
        ? [row[4]]
        : [row[1]]
  }));

  const callback = e.parameter.callback || 'callback';
  const jsonp = `${callback}(${JSON.stringify(result)});`;

  return ContentService.createTextOutput(jsonp)
    .setMimeType(ContentService.MimeType.JAVASCRIPT);
}
